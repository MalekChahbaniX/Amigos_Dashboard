# HTTPS Architecture & Data Flow

## Complete System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PRODUCTION DEPLOYMENT                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   User Browser           â”‚         â”‚   Vite Build Output      â”‚    â”‚
â”‚  â”‚ (https://domain.com)     â”‚         â”‚   (dist/ folder)         â”‚    â”‚
â”‚  â”‚                          â”‚         â”‚                          â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚ index.html         â”‚  â”‚         â”‚  â”‚ Environment:     â”‚   â”‚    â”‚
â”‚  â”‚  â”‚ (served over HTTPS)â”‚  â”‚         â”‚  â”‚ .env.production  â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚         â”‚  â”‚                  â”‚   â”‚    â”‚
â”‚  â”‚         â”‚                â”‚         â”‚  â”‚ VITE_API_URL =   â”‚   â”‚    â”‚
â”‚  â”‚         â”‚ npm run build   â”‚         â”‚  â”‚ https://domain.. â”‚   â”‚    â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â”‚                                    â”‚                          â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚ api.ts compiled    â”‚            â”‚  â”‚ getApiBaseUrl()  â”‚   â”‚    â”‚
â”‚  â”‚  â”‚                    â”‚            â”‚  â”‚ resolved to:     â”‚   â”‚    â”‚
â”‚  â”‚  â”‚ API_BASE_URL =     â”‚            â”‚  â”‚ https://domain.. â”‚   â”‚    â”‚
â”‚  â”‚  â”‚ https://domain.com/â”‚            â”‚  â”‚                  â”‚   â”‚    â”‚
â”‚  â”‚  â”‚ api                â”‚            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚         â”‚                                      â”‚                      â”‚
â”‚         â”‚ User opens                           â”‚ Generated on build  â”‚
â”‚         â”‚ https://domain.com                   â”‚                     â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                    â”‚                                                  â”‚
â”‚                    â–¼                                                  â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚         â”‚ React App Loads          â”‚                                 â”‚
â”‚         â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                                 â”‚
â”‚         â”‚ â”‚ URL Config Executed  â”‚ â”‚                                 â”‚
â”‚         â”‚ â”‚ getApiBaseUrl()      â”‚ â”‚                                 â”‚
â”‚         â”‚ â”‚                      â”‚ â”‚                                 â”‚
â”‚         â”‚ â”‚ 1. Check VITE_API_.. â”‚ â”‚ â† Finds https://domain.com/apiâ”‚
â”‚         â”‚ â”‚    âœ“ Found! Use it   â”‚ â”‚                                 â”‚
â”‚         â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                                 â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                    â”‚                                                  â”‚
â”‚                    â–¼                                                  â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚    â”‚ API Calls Initiated            â”‚                                â”‚
â”‚    â”‚ Example: Create Provider       â”‚                                â”‚
â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                                â”‚
â”‚    â”‚ â”‚ POST /api/providers      â”‚   â”‚                                â”‚
â”‚    â”‚ â”‚ https://domain.com/api/  â”‚   â”‚  â† HTTPS encrypted!           â”‚
â”‚    â”‚ â”‚ providers                â”‚   â”‚                                â”‚
â”‚    â”‚ â”‚                          â”‚   â”‚                                â”‚
â”‚    â”‚ â”‚ Body:                    â”‚   â”‚                                â”‚
â”‚    â”‚ â”‚ {                        â”‚   â”‚                                â”‚
â”‚    â”‚ â”‚   name: "Pizza House"    â”‚   â”‚                                â”‚
â”‚    â”‚ â”‚   email: "...@...tn"     â”‚   â”‚  â† Email required (fixed!)   â”‚
â”‚    â”‚ â”‚   password: "hashed..." â”‚   â”‚  â† Password sent (new!)       â”‚
â”‚    â”‚ â”‚   ...                    â”‚   â”‚                                â”‚
â”‚    â”‚ â”‚ }                        â”‚   â”‚                                â”‚
â”‚    â”‚ â”‚                          â”‚   â”‚                                â”‚
â”‚    â”‚ â”‚ Headers:                 â”‚   â”‚                                â”‚
â”‚    â”‚ â”‚ Authorization: Bearer .. â”‚   â”‚                                â”‚
â”‚    â”‚ â”‚ Content-Type: json       â”‚   â”‚                                â”‚
â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                                â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                    â”‚                                                  â”‚
â”‚                    â”‚ HTTPS Connection                                â”‚
â”‚                    â”‚ (TLS/SSL Encrypted)                             â”‚
â”‚                    â”‚                                                  â”‚
â”‚                    â–¼                                                  â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚
â”‚         â”‚ Backend Server      â”‚                                      â”‚
â”‚         â”‚ (Express.js)        â”‚                                      â”‚
â”‚         â”‚ Port: 443 (HTTPS)   â”‚                                      â”‚
â”‚         â”‚                     â”‚                                      â”‚
â”‚         â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                                      â”‚
â”‚         â”‚ â”‚ providerController
â”‚         â”‚ â”‚ .js             â”‚ â”‚                                      â”‚
â”‚         â”‚ â”‚                 â”‚ â”‚                                      â”‚
â”‚         â”‚ â”‚ createProvider: â”‚ â”‚                                      â”‚
â”‚         â”‚ â”‚ 1. Validate all â”‚ â”‚  â† Email now required              â”‚
â”‚         â”‚ â”‚    fields       â”‚ â”‚                                      â”‚
â”‚         â”‚ â”‚ 2. Check unique â”‚ â”‚                                      â”‚
â”‚         â”‚ â”‚ 3. Hash passwordâ”‚ â”‚  â† Uses bcryptjs (fixed!)          â”‚
â”‚         â”‚ â”‚    with bcrypt  â”‚ â”‚                                      â”‚
â”‚         â”‚ â”‚ 4. Save to DB   â”‚ â”‚                                      â”‚
â”‚         â”‚ â”‚ 5. Return 201   â”‚ â”‚                                      â”‚
â”‚         â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                                      â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
â”‚                    â”‚                                                  â”‚
â”‚                    â–¼                                                  â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚
â”‚         â”‚ MongoDB Database    â”‚                                      â”‚
â”‚         â”‚                     â”‚                                      â”‚
â”‚         â”‚ Provider Document:  â”‚                                      â”‚
â”‚         â”‚ {                   â”‚                                      â”‚
â”‚         â”‚   name: "...",      â”‚                                      â”‚
â”‚         â”‚   email: "...",     â”‚                                      â”‚
â”‚         â”‚   password: "$2a$.."â”‚ â† Bcryptjs hashed                  â”‚
â”‚         â”‚   ...               â”‚                                      â”‚
â”‚         â”‚ }                   â”‚                                      â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Development vs Production Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DEVELOPMENT FLOW                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  npm run dev                                                         â”‚
â”‚       â”‚                                                              â”‚
â”‚       â”œâ”€ Load .env                                                  â”‚
â”‚       â”‚  â”œâ”€ VITE_API_URL = https://domain.com/api                 â”‚
â”‚       â”‚  â””â”€ VITE_DEV_API_URL = http://192.168.1.104:5000/api âœ“    â”‚
â”‚       â”‚                                                              â”‚
â”‚       â”œâ”€ Vite Dev Server                                            â”‚
â”‚       â”‚  â””â”€ http://localhost:5173                                   â”‚
â”‚       â”‚                                                              â”‚
â”‚       â”œâ”€ React App Loads                                            â”‚
â”‚       â”‚  â”œâ”€ getApiBaseUrl() executes                               â”‚
â”‚       â”‚  â”œâ”€ VITE_API_URL found? Yes, but...                        â”‚
â”‚       â”‚  â”œâ”€ For dev, we prefer VITE_DEV_API_URL                   â”‚
â”‚       â”‚  â””â”€ Uses: http://192.168.1.104:5000/api âœ“                â”‚
â”‚       â”‚                                                              â”‚
â”‚       â”œâ”€ API Calls Made                                             â”‚
â”‚       â”‚  â”œâ”€ POST http://192.168.1.104:5000/api/providers          â”‚
â”‚       â”‚  â”œâ”€ No HTTPS certificate needed                            â”‚
â”‚       â”‚  â””â”€ Works on localhost development                         â”‚
â”‚       â”‚                                                              â”‚
â”‚       â””â”€ Benefits:                                                  â”‚
â”‚           âœ… No SSL setup needed                                    â”‚
â”‚           âœ… Fast development                                       â”‚
â”‚           âœ… Easy debugging                                         â”‚
â”‚           âœ… Real API testing                                       â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         PRODUCTION FLOW                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  npm run build                                                       â”‚
â”‚       â”‚                                                              â”‚
â”‚       â”œâ”€ Load .env.production                                       â”‚
â”‚       â”‚  â”œâ”€ VITE_API_URL = https://domain.com/api âœ“               â”‚
â”‚       â”‚  â””â”€ VITE_DEV_API_URL = (not set)                          â”‚
â”‚       â”‚                                                              â”‚
â”‚       â”œâ”€ Build Optimization                                         â”‚
â”‚       â”‚  â”œâ”€ Minify JavaScript                                       â”‚
â”‚       â”‚  â”œâ”€ Bundle assets                                           â”‚
â”‚       â”‚  â””â”€ Output to dist/                                         â”‚
â”‚       â”‚                                                              â”‚
â”‚       â”œâ”€ Deploy to Server                                           â”‚
â”‚       â”‚  â”œâ”€ Copy dist/ to server                                    â”‚
â”‚       â”‚  â”œâ”€ Serve over HTTPS                                        â”‚
â”‚       â”‚  â””â”€ Configure CORS                                          â”‚
â”‚       â”‚                                                              â”‚
â”‚       â”œâ”€ Browser Opens App                                          â”‚
â”‚       â”‚  â”œâ”€ URL: https://domain.com                                â”‚
â”‚       â”‚  â””â”€ Loads dist/index.html                                  â”‚
â”‚       â”‚                                                              â”‚
â”‚       â”œâ”€ React App Loads                                            â”‚
â”‚       â”‚  â”œâ”€ getApiBaseUrl() executes                               â”‚
â”‚       â”‚  â”œâ”€ VITE_API_URL found? Yes! âœ“                            â”‚
â”‚       â”‚  â””â”€ Uses: https://domain.com/api âœ“                        â”‚
â”‚       â”‚                                                              â”‚
â”‚       â”œâ”€ API Calls Made                                             â”‚
â”‚       â”‚  â”œâ”€ POST https://domain.com/api/providers                 â”‚
â”‚       â”‚  â”œâ”€ HTTPS encrypted                                        â”‚
â”‚       â”‚  â”œâ”€ Matches page protocol                                  â”‚
â”‚       â”‚  â””â”€ No mixed content warnings âœ“                           â”‚
â”‚       â”‚                                                              â”‚
â”‚       â””â”€ Benefits:                                                  â”‚
â”‚           âœ… Secure encrypted connection                            â”‚
â”‚           âœ… No mixed content issues                                â”‚
â”‚           âœ… Passes security audits                                 â”‚
â”‚           âœ… Professional deployment                                â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## API URL Resolution Decision Tree

```
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ App Initializes â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ getApiBaseUrl() called  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Is VITE_API_URL defined?    â”‚
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ YES           â”‚ NO
                         â”‚               â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Return it       â”‚    â”‚ Check VITE_DEV_... ? â”‚
          â”‚ (Production URL)â”‚    â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                 â”‚        â”‚ YES      â”‚ NO
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚          â”‚
                   â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚         â”‚ Return it â”‚  â”‚ Match page proto   â”‚
                   â”‚         â”‚ (Dev URL) â”‚  â”‚                    â”‚
                   â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜  â”‚ if (https?) {      â”‚
                   â”‚                 â”‚     â”‚   https://...      â”‚
                   â”‚                 â”‚     â”‚ } else {           â”‚
                   â”‚                 â”‚     â”‚   http://...       â”‚
                   â”‚                 â”‚     â”‚ }                  â”‚
                   â”‚                 â”‚     â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                 â”‚         â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                            â”‚            â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                    â”‚  API_BASE_URL set        â”‚
                    â”‚  Ready for API calls     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ First API Request    â”‚
                    â”‚ (e.g., GET providers)â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Uses Correct Protocol  â”‚
                    â”‚ & Domain               â”‚
                    â”‚                        â”‚
                    â”‚ Dev: http://localhost â”‚
                    â”‚ Prod: https://domain  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Protocol Matching Logic (Fallback)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SMART FALLBACK: Protocol Matching                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  Scenario: Both VITE variables undefined            â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚  â”‚ getApiBaseUrl()  â”‚                               â”‚
â”‚  â”‚ reads current    â”‚                               â”‚
â”‚  â”‚ page protocol    â”‚                               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚           â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ window.location.protocol = ?   â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚       â”‚                     â”‚                       â”‚
â”‚   "https:"             "http:"                      â”‚
â”‚       â”‚                     â”‚                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ Return:    â”‚         â”‚ Return:    â”‚             â”‚
â”‚  â”‚ https://.. â”‚         â”‚ http://..  â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                     â”‚
â”‚  Why this helps:                                    â”‚
â”‚  - If app moved to https, API also uses https     â”‚
â”‚  - If app on http, API also uses http             â”‚
â”‚  - Prevents mixed content automatically            â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Environment File Loading (Vite)

```
Development Startup:
  npm run dev
       â”‚
       â”œâ”€ Vite loads .env (development)
       â”‚  â”œâ”€ Reads all VITE_* variables
       â”‚  â”œâ”€ VITE_API_URL = "https://..."
       â”‚  â”œâ”€ VITE_DEV_API_URL = "http://..."
       â”‚  â””â”€ Available as import.meta.env.*
       â”‚
       â””â”€ Dev server runs

Production Build:
  npm run build
       â”‚
       â”œâ”€ Vite loads .env (development)
       â”‚  â””â”€ But then...
       â”‚
       â”œâ”€ Vite ALSO loads .env.production (overrides)
       â”‚  â”œâ”€ VITE_API_URL = "https://domain.com/api"
       â”‚  â”œâ”€ VITE_DEV_API_URL = (not in this file)
       â”‚  â””â”€ Production values win
       â”‚
       â”œâ”€ Bundle created with production values
       â”‚  â”œâ”€ Hard-coded in getApiBaseUrl()
       â”‚  â””â”€ Immutable after build
       â”‚
       â””â”€ dist/ folder ready for deployment
```

---

## Complete Request/Response Flow

```
DEVELOPMENT REQUEST:
Browser: http://localhost:5173
    â”‚
    â”œâ”€ App loads, getApiBaseUrl() = http://192.168.1.104:5000/api
    â”‚
    â””â”€ Creates request:
       POST http://192.168.1.104:5000/api/providers
       â”œâ”€ Headers:
       â”‚  â”œâ”€ Authorization: Bearer <token>
       â”‚  â”œâ”€ Content-Type: application/json
       â”‚  â””â”€ Origin: http://localhost:5173
       â”‚
       â””â”€ Body:
          {
            name: "Pizza House",
            email: "contact@...",
            password: "hashed...",
            ...
          }

           â”‚
           â–¼ (HTTP - no encryption needed on localhost)

       Express Server: 192.168.1.104:5000
       â”œâ”€ Middleware processes
       â”œâ”€ providerController.createProvider()
       â”‚  â”œâ”€ Validates all fields (including email)
       â”‚  â”œâ”€ Hashes password with bcryptjs
       â”‚  â”œâ”€ Saves to MongoDB
       â”‚  â””â”€ Returns 201 Created
       â”‚
       â””â”€ Response:
          {
            message: "Provider created",
            provider: { id, name, email, ... }
          }

           â”‚
           â–¼

Browser receives and displays success message

---

PRODUCTION REQUEST:
Browser: https://domain.com
    â”‚
    â”œâ”€ App loads, getApiBaseUrl() = https://domain.com/api
    â”‚
    â””â”€ Creates request:
       POST https://domain.com/api/providers
       â”œâ”€ Headers:
       â”‚  â”œâ”€ Authorization: Bearer <token>
       â”‚  â”œâ”€ Content-Type: application/json
       â”‚  â””â”€ Origin: https://domain.com
       â”‚
       â””â”€ Body: (same as above)

           â”‚
           â–¼ (HTTPS - encrypted with TLS/SSL)

       Reverse Proxy (Nginx): https port 443
       â”œâ”€ TLS termination
       â”œâ”€ Routes to backend
       â”‚
       â””â”€ Backend Server: 192.168.1.104:5000
          (same processing as above)

           â”‚
           â–¼

       Reverse Proxy: encrypts response

           â”‚
           â–¼

Browser receives encrypted response, decrypts with TLS key
Displays success message
```

---

## Summary

âœ… **Architecture Components:**
1. Frontend: Smart URL resolution function
2. Environment files: Separate dev and production configs
3. Backend: Same endpoints, accessed via correct protocol
4. Database: No changes needed

âœ… **Protocol Flow:**
- Development: HTTP to localhost (simple, fast)
- Production: HTTPS to domain (secure, encrypted)
- Automatic protocol matching in fallback

âœ… **Benefits:**
- No mixed content warnings
- Secure production environment
- Easy local development
- Best practices implemented

**Status: Production ready with complete architecture** ğŸš€
